{% extends "base.html" %}

{% block content %}
<div class="card">
    <div id="status" hx-get="/status" hx-trigger="load, every 5s" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card preview">
    <h2>Display Preview</h2>
    <img id="lcd-preview" src="/lcd.png" alt="LCD Preview">
    <div class="refresh-controls">
        <label>Refresh Interval: <span id="refresh-value">2000</span>ms</label>
        <input type="range" id="refresh-slider" min="1500" max="10000" step="500" value="2000">
    </div>
</div>
<script>
(function() {
    const img = document.getElementById('lcd-preview');
    const slider = document.getElementById('refresh-slider');
    const label = document.getElementById('refresh-value');
    let intervalId = null;

    function refresh() {
        const next = new Image();
        next.onload = () => { img.src = next.src; };
        next.src = '/lcd.png?t=' + Date.now();
    }

    function start(ms) {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(refresh, ms);
        fetch('/refresh-interval', { method: 'POST', body: 'interval=' + ms, headers: {'Content-Type': 'application/x-www-form-urlencoded'} });
    }

    slider.oninput = function() {
        label.textContent = this.value;
        start(parseInt(this.value));
    };

    start(2000);
})();
</script>

<div class="section">
    <h3 class="section-header">LCD Display</h3>

    <div class="card">
        <h2>Orientation</h2>
        <div id="orientation" hx-get="/orientation" hx-trigger="load" hx-swap="innerHTML">
            Loading...
        </div>
    </div>

    <div class="card-row">
        <div class="card">
            <h2>Theme</h2>
            <div id="theme-controls" hx-get="/theme" hx-trigger="load" hx-swap="innerHTML">
                Loading...
            </div>
        </div>

        <div class="card">
            <h2>Display Face</h2>
            <div id="face-controls" hx-get="/face" hx-trigger="load" hx-swap="innerHTML"
                 hx-on::after-settle="htmx.trigger('#complications-controls', 'reload')">
                Loading...
            </div>
        </div>
    </div>

    <div class="card" style="margin-top: 1rem;">
        <h2>Complications</h2>
        <div id="complications-controls" hx-get="/complications" hx-trigger="load, reload" hx-swap="innerHTML">
            Loading...
        </div>
    </div>
</div>

<div class="section">
    <h3 class="section-header">LED Strip</h3>

    <div class="card">
        <div id="led-controls" hx-get="/led" hx-trigger="load" hx-swap="innerHTML">
            Loading...
        </div>
    </div>
</div>
{% endblock %}
