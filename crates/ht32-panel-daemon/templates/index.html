{% extends "base.html" %}

{% block content %}
<div class="card">
    <div id="status" hx-get="/status" hx-trigger="load, every 5s" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card preview">
    <h2>Display Preview</h2>
    <img id="lcd-preview" src="/lcd.png" alt="LCD Preview">
    <div class="refresh-controls">
        <label>Refresh: <span id="refresh-value">2</span>s</label>
        <input type="range" id="refresh-slider" min="2" max="60" step="1" value="2">
    </div>
</div>
<script>
(function() {
    const img = document.getElementById('lcd-preview');
    const slider = document.getElementById('refresh-slider');
    const label = document.getElementById('refresh-value');
    let intervalId = null;

    function refresh() {
        const next = new Image();
        next.onload = () => { img.src = next.src; };
        next.src = '/lcd.png?t=' + Date.now();
    }

    function start(secs) {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(refresh, secs * 1000);
        fetch('/refresh-rate', { method: 'POST', body: 'rate=' + secs, headers: {'Content-Type': 'application/x-www-form-urlencoded'} });
    }

    slider.oninput = function() {
        label.textContent = this.value;
        start(parseInt(this.value));
    };

    start(2);
})();
</script>

<div class="card">
    <h2>Orientation</h2>
    <div id="orientation" hx-get="/orientation" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card">
    <h2>Network Interface</h2>
    <div id="network-interface" hx-get="/network-interface" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card">
    <h2>Colors</h2>
    <div id="color-controls" hx-get="/colors" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card">
    <h2>Background Image</h2>
    <div id="background-controls" hx-get="/background" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card">
    <h2>Display Face</h2>
    <div id="face-controls" hx-get="/face" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card">
    <h2>LED Strip</h2>
    <div id="led-controls" hx-get="/led" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>

<div class="card">
    <h2>Widgets</h2>
    <div id="widgets" hx-get="/widgets" hx-trigger="load" hx-swap="innerHTML">
        Loading...
    </div>
</div>
{% endblock %}
